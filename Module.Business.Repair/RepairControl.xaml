<UserControl x:Class="Module.Business.Repair.RepairControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:local="clr-namespace:Module.Business.Repair"
             xmlns:vm="clr-namespace:Module.Business.Repair.ViewModels"
             xmlns:hc="https://handyorg.github.io/handycontrol"
             mc:Ignorable="d"
             d:DesignHeight="600" d:DesignWidth="400">

    <UserControl.Resources>
        <ResourceDictionary>
            <!-- 状态指示器样式 -->
            <Style x:Key="SuccessStatusIndicator" TargetType="Ellipse">
                <Setter Property="Width" Value="12"/>
                <Setter Property="Height" Value="12"/>
                <Setter Property="Fill" Value="#4CAF50"/>
                <Setter Property="HorizontalAlignment" Value="Center"/>
                <Setter Property="VerticalAlignment" Value="Center"/>
                <Setter Property="Effect">
                    <Setter.Value>
                        <DropShadowEffect Color="#4CAF50" BlurRadius="8" ShadowDepth="0" Opacity="0.6"/>
                    </Setter.Value>
                </Setter>
            </Style>

            <Style x:Key="DangerStatusIndicator" TargetType="Ellipse">
                <Setter Property="Width" Value="12"/>
                <Setter Property="Height" Value="12"/>
                <Setter Property="Fill" Value="#F44336"/>
                <Setter Property="HorizontalAlignment" Value="Center"/>
                <Setter Property="VerticalAlignment" Value="Center"/>
                <Setter Property="Effect">
                    <Setter.Value>
                        <DropShadowEffect Color="#F44336" BlurRadius="8" ShadowDepth="0" Opacity="0.6"/>
                    </Setter.Value>
                </Setter>
            </Style>

            <!-- 数据模板 -->
            <DataTemplate x:Key="RepairRecordTemplate" DataType="{x:Type vm:RepairRecordViewModel}">
                <hc:Card Margin="0,0,0,8" Padding="0">
                    <Grid Margin="8">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="32"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- 状态指示器 -->
                        <Ellipse Grid.Column="0"
                                 Margin="0,8,8,0"
                                 Width="14"
                                 Height="14"
                                 HorizontalAlignment="Center"
                                 VerticalAlignment="Center">
                            <Ellipse.Style>
                                <Style TargetType="Ellipse" BasedOn="{StaticResource SuccessStatusIndicator}">
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IsLoaded}" Value="False">
                                            <Setter Property="Fill" Value="#F44336"/>
                                            <Setter Property="Effect">
                                                <Setter.Value>
                                                    <DropShadowEffect Color="#F44336" BlurRadius="8" ShadowDepth="0" Opacity="0.6"/>
                                                </Setter.Value>
                                            </Setter>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Ellipse.Style>
                        </Ellipse>

                        <!-- 内容区域 -->
                        <StackPanel Grid.Column="1">
                            <!-- 零件码 -->
                            <TextBlock Text="{Binding PartCode}"
                                       FontSize="14" FontWeight="Bold"
                                       Margin="0,0,0,8"/>

                            <!-- 状态信息 -->
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                                <TextBlock Text="状态:" FontWeight="Medium"
                                           Margin="0,0,8,0" VerticalAlignment="Center"/>
                                <hc:Tag Content="{Binding StatusText}"
                                        FontSize="12">
                                    <hc:Tag.Style>
                                        <Style TargetType="hc:Tag">
                                            <Setter Property="Background" Value="#F44336"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsLoaded}" Value="True">
                                                    <Setter Property="Background" Value="#4CAF50"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </hc:Tag.Style>
                                </hc:Tag>
                            </StackPanel>

                            <!-- 下料时间 -->
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                                <TextBlock Text="&#xe680;" Style="{StaticResource IconText}"
                                           Margin="0,0,8,0" VerticalAlignment="Center"/>
                                <TextBlock Text="下料时间:" FontWeight="Medium"
                                           Margin="0,0,8,0" VerticalAlignment="Center"/>
                                <TextBlock Text="{Binding UnloadTimeText}"
                                           VerticalAlignment="Center"/>
                            </StackPanel>

                            <!-- 上料时间 -->
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="&#xe680;" Style="{StaticResource IconText}"
                                            Margin="0,0,8,0" VerticalAlignment="Center"/>
                                <TextBlock Text="上料时间:" FontWeight="Medium"
                                           Margin="0,0,8,0" VerticalAlignment="Center"/>
                                <TextBlock Text="{Binding LoadTimeText}" VerticalAlignment="Center">
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding LoadTimeText}" Value="-">
                                                    <Setter Property="FontStyle" Value="Italic"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                            </StackPanel>
                        </StackPanel>
                    </Grid>
                </hc:Card>
            </DataTemplate>
        </ResourceDictionary>
    </UserControl.Resources>

    <Grid Margin="8">
        <hc:Card Padding="0">
            <Grid>
                <Grid.RowDefinitions>
                    <!-- 头部：标题和刷新按钮 -->
                    <RowDefinition Height="40" />
                    <!-- 内容区域 -->
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>

                <!-- 头部 -->
                <Border BorderThickness="0,0,0,1" BorderBrush="{StaticResource BorderBrush}" Grid.Row="0">
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center"
                                Margin="16,0">
                        <TextBlock Text="&#xe678;" FontSize="20"
                                   Style="{StaticResource IconText}"
                                   Margin="0,0,12,0"/>
                        <TextBlock Text="返修台" FontSize="16"
                                   Foreground="{DynamicResource TextPrimaryBrush}"
                                   VerticalAlignment="Center" />
                    </StackPanel>
                </Border>
 
                <!-- 内容区域 -->
                <Grid Grid.Row="1">
                    <!-- 加载状态 -->
                    <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                        <StackPanel.Style>
                            <Style TargetType="StackPanel">
                                <Setter Property="Visibility" Value="Collapsed"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsLoading}" Value="True">
                                        <Setter Property="Visibility" Value="Visible"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </StackPanel.Style>
                        <hc:LoadingCircle/>
                        <TextBlock Text="正在加载..." Margin="0,10,0,0"
                                   HorizontalAlignment="Center"
                                   Foreground="{DynamicResource TextIconBrush}"/>
                    </StackPanel>

                    <!-- 数据列表 -->
                    <hc:ScrollViewer IsInertiaEnabled="True" hc:ScrollViewerAttach.AutoHide="False"
                                  Padding="16">
                        <hc:ScrollViewer.Style>
                            <Style TargetType="hc:ScrollViewer">
                                <Setter Property="Visibility" Value="Visible"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsLoading}" Value="True">
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </hc:ScrollViewer.Style>
                        <ItemsControl ItemsSource="{Binding RepairRecords}"
                                      ItemTemplate="{StaticResource RepairRecordTemplate}">
                            <ItemsControl.Style>
                                <Style TargetType="ItemsControl">
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding RepairRecords.Count}" Value="0">
                                            <Setter Property="Template">
                                                <Setter.Value>
                                                    <ControlTemplate>
                                                        <StackPanel HorizontalAlignment="Center"
                                                                    VerticalAlignment="Center"
                                                                    Margin="50">
                                                            <hc:SimpleText Text="&#xe65e;" FontSize="48"
                                                                           Foreground="{DynamicResource TextIconBrush}"
                                                                           HorizontalAlignment="Center"/>
                                                            <TextBlock Text="暂无返修记录" FontSize="16"
                                                                       Foreground="{DynamicResource TextIconBrush}"
                                                                       HorizontalAlignment="Center"
                                                                       Margin="0,10,0,0"/>
                                                        </StackPanel>
                                                    </ControlTemplate>
                                                </Setter.Value>
                                            </Setter>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </ItemsControl.Style>
                        </ItemsControl>
                    </hc:ScrollViewer>
                </Grid>
            </Grid>
        </hc:Card>
    </Grid>
</UserControl>
