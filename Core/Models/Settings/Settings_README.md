# 设置系统说明文档

## 概述

本文档描述了WinmTech-Scada系统的设置模块结构和权限控制机制。

## 设置分类

### 1. 通用设置 (GeneralSettings)

包含基本的应用程序设置：

- **开机自动启动**: 控制程序是否随系统启动
- **最小化到系统托盘**: 控制窗口最小化行为
- **启动时检查更新**: 控制是否在启动时检查程序更新
- **语言设置**: 系统界面语言（默认：zh-CN）
- **系统时区**: 时区设置（默认：China Standard Time）
- **性能监控**: 是否启用性能监控及采集间隔

### 2. 密码设置 (PasswordSettings)

控制系统权限访问：

- **普通用户密码**: Admin111（可访问通用设置和界面设置）
- **超级管理员密码**: Winm666（可访问所有设置，包括数据库、系统、通信设置）

### 3. 系统设置 (SystemSettings)

**需要超级管理员权限访问**

包含系统核心配置：

- **系统名称**: 系统显示名称
- **系统版本**: 当前版本号
- **日志级别**: 日志记录级别
- **最大日志文件数**: 日志文件保留数量
- **运行模式**: 生产模式 / 调试模式

### 4. 数据库设置 (DatabaseSettings)

**需要超级管理员权限访问**

包含数据库连接和配置信息。

### 5. 通信设置 (CommunicationSettings)

**需要超级管理员权限访问**

简化后只包含核心通信参数：

- **默认通信超时时间**: 通信超时设置（毫秒）
- **重试次数**: 通信失败重试次数
- **重试间隔**: 重试间隔时间（毫秒）
- **启用心跳检测**: 是否启用心跳机制
- **心跳检测间隔**: 心跳检测时间间隔（毫秒）
- **启用自动重连**: 是否启用自动重连
- **自动重连间隔**: 自动重连间隔（秒）
- **最大重连次数**: 最大重连尝试次数
- **数据采集间隔**: 数据采集时间间隔（毫秒）

### 6. 界面设置 (UISettings)

简化后的界面配置：

- **窗口尺寸和位置**: 窗口宽度、高度、位置
- **窗口状态**: 正常/最小化/最大化
- **显示状态栏**: 是否显示状态栏
- **主题设置**: 默认 / 暗色
- **字体设置**: 字体大小和字体名称
- **声音设置**: 声音提示和音量
- **工具提示**: 工具提示启用和延迟
- **图表设置**: 图表刷新间隔和数据点限制
- **高DPI支持**: DPI缩放设置
- **全屏模式**: 全屏模式和快捷键
- **多显示器支持**: 多显示器配置
- **窗口透明度**: 透明度设置
- **暗色模式**: 暗色模式和系统主题跟随

## 权限控制

### 权限级别

1. **无权限 (None)**: 无法访问任何设置
2. **普通用户 (Normal)**: 可访问通用设置和界面设置
3. **超级管理员 (SuperAdmin)**: 可访问所有设置

### 密码验证

- 进入设置页面需要密码验证
- 根据输入的密码确定用户权限级别
- 不同权限级别可访问不同的设置分类

### 使用方法

```csharp
// 创建密码验证服务
var passwordService = new PasswordValidationService(passwordSettings);

// 显示密码验证对话框
var permissionLevel = PasswordValidationDialog.ShowDialog(parentWindow, passwordService);

// 根据权限级别控制界面访问
if (passwordService.CanAccessDatabaseSettings())
{
    // 显示数据库设置
}
```

## 配置文件

各设置分类对应的配置文件：

- `general-settings.json`: 通用设置
- `password-settings.json`: 密码设置
- `system-settings.json`: 系统设置
- `database-settings.json`: 数据库设置
- `communication-settings.json`: 通信设置
- `ui-settings.json`: 界面设置
- `system-config.json`: 系统配置聚合文件

## 移除的功能

### 通用设置移除项
- 自动保存
- 自动保存间隔

### 系统设置移除项
- 主题设置（移至界面设置）
- 管理员邮箱
- 数据保留天数
- 开机自启动（移至通用设置）
- 最小化到系统托盘（移至通用设置）
- 启动时检查更新（移至通用设置）

### 界面设置移除项
- 显示工具栏
- 显示侧边栏
- 显示菜单栏
- 侧边栏宽度
- 界面刷新间隔
- 启用网格虚拟化
- 显示网格线
- 显示行号
- 数据网格每页行数
- 动画持续时间
- 启用动画效果

### 通信设置移除项
- 最大并发连接数
- 网络缓冲区大小
- 数据压缩
- SSL/TLS加密
- 通信日志
- 连接池
- 数据缓存
- 网络接口绑定
- IPv6支持
- 通信统计

## 注意事项

1. 密码设置文件应妥善保管，避免泄露
2. 超级管理员权限可以修改系统核心配置，请谨慎操作
3. 运行模式的修改可能影响系统行为，建议在了解影响后再进行修改
4. 主题设置现在只支持"默认"和"暗色"两种模式
