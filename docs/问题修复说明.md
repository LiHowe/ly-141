# 问题修复说明

## 问题描述

在运行应用程序时遇到以下错误：

```
System.InvalidOperationException: Triggers 集合成员必须是类型 EventTrigger。 
   at System.Windows.EventTrigger.ProcessOneTrigger(FrameworkElement triggersHost, TriggerBase triggerBase)
   at System.Windows.EventTrigger.ProcessTriggerCollection(FrameworkElement triggersHost)
   at System.Windows.FrameworkElement.TryFireInitialized()
   at MS.Internal.Xaml.Runtime.ClrObjectRuntime.InitializationGuard(XamlType xamlType, Object obj, Boolean begin)
```

## 问题原因

在 XAML 中，`TextBlock.Triggers` 集合只能包含 `EventTrigger` 类型的触发器，不能包含 `DataTrigger`。

原始的错误代码：
```xml
<TextBlock Text="{Binding LoadTimeText}" Style="{StaticResource ValueText}">
    <TextBlock.Triggers>
        <DataTrigger Binding="{Binding LoadTimeText}" Value="-">
            <Setter Property="Style" Value="{StaticResource PlaceholderText}"/>
        </DataTrigger>
    </TextBlock.Triggers>
</TextBlock>
```

## 解决方案

将 `DataTrigger` 移动到 `Style.Triggers` 中，这是正确的做法：

```xml
<TextBlock Text="{Binding LoadTimeText}">
    <TextBlock.Style>
        <Style TargetType="TextBlock" BasedOn="{StaticResource ValueText}">
            <Style.Triggers>
                <DataTrigger Binding="{Binding LoadTimeText}" Value="-">
                    <Setter Property="Foreground" Value="{DynamicResource TextIconBrush}"/>
                    <Setter Property="FontStyle" Value="Italic"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>
    </TextBlock.Style>
</TextBlock>
```

## 修复内容

1. **移除了错误的 Triggers 使用**：从 `TextBlock.Triggers` 移除了 `DataTrigger`
2. **正确使用 Style.Triggers**：在 `Style.Triggers` 中定义 `DataTrigger`
3. **保持功能不变**：修复后的代码实现相同的视觉效果

## 验证结果

- ✅ 编译成功，无错误
- ✅ 运行时不再出现 `InvalidOperationException`
- ✅ 上料时间为空时正确显示占位符样式（斜体、灰色）
- ✅ 上料时间有值时正常显示

## WPF 触发器使用规则

### Element.Triggers 集合
- 只能包含 `EventTrigger`
- 用于响应路由事件
- 通常用于动画和故事板

### Style.Triggers 集合
- 可以包含 `Trigger`、`DataTrigger`、`MultiTrigger`、`MultiDataTrigger`
- 用于基于属性值或数据绑定值改变样式
- 这是最常用的触发器位置

### ControlTemplate.Triggers 集合
- 可以包含所有类型的触发器
- 用于在控件模板中定义触发器

## 最佳实践

1. **数据驱动的样式变化**：使用 `Style.Triggers` 中的 `DataTrigger`
2. **属性驱动的样式变化**：使用 `Style.Triggers` 中的 `Trigger`
3. **事件驱动的动画**：使用 `Element.Triggers` 中的 `EventTrigger`
4. **复杂条件**：使用 `MultiTrigger` 或 `MultiDataTrigger`

## 相关文件

- `Module.Business.Repair/RepairControl.xaml` - 修复了触发器使用错误
- `Module.Business.Repair/Styles/RepairControlStyles.xaml` - 样式定义文件

修复完成后，应用程序可以正常运行，返修模块的界面能够正确显示状态指示器和占位符文本。
