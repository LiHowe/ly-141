<Window x:Class="MainApp.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:hc="https://handyorg.github.io/handycontrol"
        xmlns:vm="clr-namespace:MainApp.ViewModels"
        xmlns:core="clr-namespace:Core.Services;assembly=Core"
        xmlns:loc="clr-namespace:Core.Localization;assembly=Core"
        xmlns:controls="clr-namespace:UI.Controls;assembly=UI"
        d:DataContext="{d:DesignInstance vm:MainWindowViewModel}"
        mc:Ignorable="d"
        Title="WinmTech-Scada 工业数据采集与追溯系统"
        Height="960" Width="1440"
        MinHeight="600" MinWidth="800"
        WindowStartupLocation="CenterScreen"
        WindowState="Normal"
        WindowStyle="None"
        AllowsTransparency="False"
        ResizeMode="CanMinimize"
        StateChanged="Window_StateChanged">

    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <!-- 引用HandyControl集成主题 -->
                <ResourceDictionary Source="pack://application:,,,/UI;component/Themes/Generic.xaml" />
            </ResourceDictionary.MergedDictionaries>
            <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter" />
            <!-- 窗体控制按钮样式 -->

            <!-- 关闭按钮特殊样式 -->
            <Style x:Key="CloseButtonStyle" TargetType="Button" BasedOn="{StaticResource ButtonIcon}">
                <Style.Triggers>
                    <Trigger Property="IsMouseOver" Value="True">
                        <Setter Property="Background" Value="#E81123" />
                    </Trigger>
                    <Trigger Property="IsPressed" Value="True">
                        <Setter Property="Background" Value="#F1707A" />
                    </Trigger>
                </Style.Triggers>
            </Style>

            <!-- 模块菜单按钮样式 -->
        </ResourceDictionary>
    </Window.Resources>

    <Border BorderBrush="{StaticResource SecondaryBorderBrush}" BorderThickness="1">

        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="50" />
                <RowDefinition Height="*" />
                <RowDefinition Height="30" />
            </Grid.RowDefinitions>

            <!-- 头部区域 -->
            <Border Grid.Row="0" Background="{StaticResource SecondaryBorderBrush}" MouseLeftButtonDown="TitleBar_MouseLeftButtonDown">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <!-- 左侧：程序图标和标题 -->
                    <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center" Margin="15,0">
                        <!-- 程序图标占位符 -->

                        <Image Source="/Resources/Images/logo_white.png"
                               Width="24" Height="24" Margin="0,0, 10,0" />
                        <TextBlock Text="{Binding Title}"
                                   Foreground="{StaticResource PrimaryTextBrush}"
                                   FontSize="18"
                                   FontWeight="Bold"
                                   VerticalAlignment="Center" />
                    </StackPanel>

                    <!-- 中间：模块菜单 -->
                    <StackPanel Grid.Column="1"
                                Name="MenuPanel"
                                Orientation="Horizontal"
                                VerticalAlignment="Center"
                                HorizontalAlignment="Left" />

                    <!-- 右侧：用户信息、设置和窗体控制 -->
                    <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                        <!-- 语言切换 -->
                        <Button Name="LangButton"
                                Foreground="White"
                                Content="&#xe602;"
                                FontFamily="{StaticResource Icon}"
                                Style="{StaticResource ButtonDefault}"
                                Background="Transparent"
                                BorderThickness="0"
                                FontSize="16"
                                Click="LangButton_Click"
                                ToolTip="{loc:Lang Language}"/>
                        <Popup AllowsTransparency="True" PlacementTarget="{Binding ElementName=LangButton}" Placement="Center"  Name="PopupConfig" VerticalOffset="40" StaysOpen="False">
                            <Border Background="{DynamicResource SecondaryRegionBrush}" CornerRadius="4" Margin="16" Effect="{StaticResource EffectShadow2}">
                                <StackPanel Orientation="Horizontal">
                                    <hc:UniformSpacingPanel Button.Click="ButtonLangs_OnClick" Margin="10" Spacing="10" ChildWrapping="Wrap">
                                        <Button Tag="zh-CN" Style="{StaticResource ButtonCustom}" ToolTip="中文">
                                            <TextBlock Style="{StaticResource IconText}" Text="&#xebe2;" FontSize="20"/>
                                        </Button>
                                        <Button Tag="en-US" Style="{StaticResource ButtonCustom}" ToolTip="English">
                                            <TextBlock Style="{StaticResource IconText}" Text="&#xebe0;" FontSize="20"/>
                                        </Button>
                                        <Button Tag="fr-FR" Style="{StaticResource ButtonCustom}" ToolTip="Français">
                                            <TextBlock Style="{StaticResource IconText}" Text="&#xe74a;" FontSize="20"/>
                                        </Button>
                                    </hc:UniformSpacingPanel>
                                </StackPanel>
                            </Border>
                        </Popup>
                        <!-- 设置按钮 -->
                        <Button Name="SettingsButton"
                                Foreground="White"
                                Content="&#xe657;"
                                FontFamily="{StaticResource Icon}"
                                Style="{StaticResource ButtonDefault}"
                                Background="Transparent"
                                BorderThickness="0"
                                FontSize="16"
                                ToolTip="{loc:Lang Settings}"
                                Click="SettingsButton_Click" />

                        <!-- 关于按钮 -->
                        <Button Name="AboutButton"
                                Content="?"
                                Style="{StaticResource ButtonIcon}"
                                hc:IconElement.Geometry="{StaticResource AskGeometry}"
                                Foreground="White"
                                ToolTip="{loc:Lang About}"
                                Click="AboutButton_Click" />

                        <!-- 窗体控制按钮 -->
                        <Button Name="MinimizeButton"
                                Foreground="White"
                                hc:IconElement.Geometry="{StaticResource WindowMinGeometry}"
                                Style="{StaticResource ButtonIcon}"
                                ToolTip="{loc:Lang MinimizeWindow}"
                                Click="MinimizeButton_Click" />

                        <Button Name="MaximizeRestoreButton"
                                Style="{StaticResource ButtonIcon}"
                                Foreground="White"
                                hc:IconElement.Geometry="{StaticResource WindowMaxGeometry}"
                                ToolTip="{loc:Lang RestoreWindow}"
                                Click="MaximizeButton_Click" />

                        <Button Name="CloseButton"
                                hc:IconElement.Geometry="{StaticResource CloseGeometry}"
                                Style="{StaticResource CloseButtonStyle}"
                                Foreground="White"
                                ToolTip="{loc:Lang Close}"
                                Click="CloseButton_Click" />
                    </StackPanel>
                </Grid>
            </Border>

            <!-- 主内容区域 -->
            <Border Grid.Row="1" Background="{DynamicResource RegionBrush}">
                <ContentControl Name="MainContentControl" />
            </Border>

            <!-- 底部状态栏 -->
            <Border Grid.Row="2" Background="{DynamicResource SecondaryRegionBrush}">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    <StackPanel Grid.Column="0" x:Name="LeftStatusPanel" Margin="10,0" Orientation="Horizontal">
                        <!-- 系统时间 -->
                        <TextBlock Name="StatusText"
                                   Text="{Binding SystemTime}"
                                   Foreground="{DynamicResource PrimaryTextBrush}"
                                   VerticalAlignment="Center"
                                   Margin="0,0,15,0" />

                        <!-- 磁盘监控 -->
                        <controls:DiskMonitor x:Name="DiskMonitorControl"
                                              DataContext="{Binding DiskMonitorViewModel}"
                                              Visibility="{Binding EnableDiskMonitor, Converter={StaticResource BoolToVisibilityConverter}}"
                                              VerticalAlignment="Center" />
                    </StackPanel>

                    <hc:NotifyIcon Grid.Column="0" Text="WinM Service" Token="Global"
                                   Icon="Resources/Images/logo_white_full.png" />
                    <Grid Grid.Column="1">
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center" HorizontalAlignment="Right"
                                    Margin="10, 0">

                            <ItemsControl ItemsSource="{Binding Connections}">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <WrapPanel Orientation="Horizontal" />
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate DataType="{x:Type controls:DeviceConnectionViewModel}">
                                        <controls:DeviceConnectionControl DataContext="{Binding}" />
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </StackPanel>
                    </Grid>
                </Grid>
            </Border>
        </Grid>
    </Border>
</Window>